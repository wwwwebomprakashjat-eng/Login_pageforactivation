<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Key.json Admin Panel (GitHub Without Backend)</title>
<style>
body{font-family:Arial;margin:20px;max-width:800px}
textarea{width:100%;height:400px;font-family:monospace}
button{padding:10px;margin:5px}
#panel{display:none}
</style>
</head>
<body>

<h2>Key.json Admin Panel</h2>
<p id="status">Checking admin…</p>

<div id="panel">
  <button onclick="loadFile()">Load Key.json</button>
  <button onclick="saveFile()">Save</button>

  <br><input id="commit" placeholder="Commit message" style="width:100%;margin:10px 0">
  <textarea id="editor">{}</textarea>
  <pre id="result"></pre>
</div>

<script>
// FIXED ADMIN EMAIL (ONLY YOU)
const ADMIN_EMAIL = "www.webomprakashjat@gmail.com";

// YOUR GITHUB APP INFO (must replace)
const CLIENT_ID = "Ov23liByBWpEww6qNnPy";       // <-- replace
const CLIENT_SECRET = "5bc3de72f78ef75aae85ec38057d2257f8b8a29b"; // <-- replace

const OWNER = "wwwwebomprakashjat-eng";
const REPO = "Login_pageforactivation";
const FILE = "Key.json";

let accessToken = null;

// Step 1: Simple email check (no Google login)
function adminCheck(){
    let mail = prompt("Enter admin email:");
    if(mail !== ADMIN_EMAIL){
        alert("❌ Not authorized");
        window.location = "https://google.com";
    } else {
        document.getElementById("panel").style.display = "block";
        document.getElementById("status").innerText = "Admin verified";
    }
}
adminCheck();

// Step 2: GitHub OAuth Login
async function githubLogin(){
    const url = `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&scope=repo`;
    window.location.href = url;
}

// Step 3: Exchange code for access token
if(window.location.search.includes("code=")){
    const code = new URLSearchParams(window.location.search).get("code");

    const res = await fetch("https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token", {
        method:"POST",
        headers:{ "Content-Type":"application/json", "Accept":"application/json" },
        body: JSON.stringify({
            client_id: CLIENT_ID,
            client_secret: CLIENT_SECRET,
            code: code
        })
    });

    const data = await res.json();
    accessToken = data.access_token;
    document.getElementById("status").innerText = "GitHub Login Successful";
}

// Step 4: Load Key.json
async function loadFile(){
    if(!accessToken) return githubLogin();

    const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE}`, {
        headers:{ Authorization:"token " + accessToken }
    });

    const j = await res.json();
    const content = atob(j.content);
    document.getElementById("editor").value = JSON.stringify(JSON.parse(content), null, 2);
    window.fileSha = j.sha;
}

// Step 5: Save/Update Key.json
async function saveFile(){
    if(!accessToken) return githubLogin();

    const content = document.getElementById("editor").value;
    const msg = document.getElementById("commit").value || "Update Key.json";

    const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE}`, {
        method:"PUT",
        headers:{ Authorization:"token " + accessToken },
        body: JSON.stringify({
            message: msg,
            content: btoa(content),
            sha: window.fileSha
        })
    });

    const j = await res.json();
    document.getElementById("result").innerText = JSON.stringify(j, null, 2);
}
</script>
</body>
</html>